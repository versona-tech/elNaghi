import Head from 'next/head';
import { useState, useEffect } from 'react';
import { 
  FaGraduationCap, FaHospital, FaBriefcase, FaRoad, 
  FaFutbol, FaChartLine, FaLeaf, FaBook, FaHome, FaHandsHelping
} from 'react-icons/fa';
import { programAPI } from '@/lib/api';

const ProgramPage = () => {
  const [program, setProgram] = useState([]);
  const [loading, setLoading] = useState(true);
  const [selectedCategory, setSelectedCategory] = useState('الكل');

  // برنامج انتخابي شامل كامل - يُعرض عند غياب بيانات API
  const fallbackProgram = [
    {
      _id: 'edu-1',
      category: 'تعليم',
      title: 'تطوير التعليم وبناء جيل واعٍ',
      description: 'نلتزم بتوفير تعليم جيد لكل طفل في الدائرة من خلال تحسين البنية التحتية للمدارس، ورفع كفاءة المعلمين، وتوفير الوسائل التعليمية الحديثة التي تواكب العصر.',
      points: [
        'صيانة وتجهيز المدارس المتهالكة وتوفير مقاعد ومرافق آمنة ونظيفة',
        'تدريب المعلمين على أحدث أساليب التدريس التفاعلية والتكنولوجيا التعليمية',
        'توفير مكتبات مدرسية محدثة ومعامل علوم ومختبرات حاسب آلي',
        'برامج دعم نفسي واجتماعي للطلاب، ومتابعة حالات التسرب من التعليم',
        'دعم الطلاب المتفوقين بمنح دراسية وتكريم شهري لتحفيز التميز',
        'فصول محو أمية مجانية للكبار بالتعاون مع الجمعيات الأهلية',
        'رقمنة الخدمات التعليمية وإنشاء منصة تواصل إلكترونية بين المدرسة وأولياء الأمور'
      ]
    },
    {
      _id: 'health-1',
      category: 'صحة',
      title: 'خدمات صحية لائقة وقريبة من الجميع',
      description: 'الصحة حق أساسي لكل مواطن. سنعمل على تطوير الوحدات الصحية، وتوفير الأدوية، وتحسين مستوى الرعاية الطبية في كل قرى الدائرة.',
      points: [
        'تطوير الوحدات الصحية وتزويدها بالأجهزة الطبية الحديثة',
        'توفير أطباء مقيمين ومتخصصين في الوحدات الصحية بدوام منتظم',
        'صيدليات مجهزة بالأدوية الأساسية ومتابعة التوريد المنتظم',
        'قوافل طبية مجانية دورية للكشف المبكر عن الأمراض المزمنة',
        'برامج توعية صحية ووقائية للأمهات والأطفال',
        'تفعيل منظومة التأمين الصحي الشامل وتسهيل إجراءات الاشتراك',
        'سيارات إسعاف مجهزة ومتاحة على مدار الساعة',
        'دعم المرضى غير القادرين في الحصول على العلاج والتحاليل'
      ]
    },
    {
      _id: 'infra-1',
      category: 'بنية تحتية',
      title: 'بنية تحتية حديثة تخدم الجميع',
      description: 'البنية التحتية الجيدة أساس أي تنمية حقيقية. سنعمل على رصف الطرق، وتوفير الإنارة، وتحسين شبكات المياه والصرف الصحي.',
      points: [
        'رصف الطرق الرئيسية والداخلية في القرى والمراكز',
        'توسيع شبكات الصرف الصحي لتغطية كل المناطق السكنية',
        'تحسين شبكات مياه الشرب وضمان جودة المياه الواصلة للمنازل',
        'إنارة الشوارع بتقنية LED الموفرة للطاقة في جميع الطرق',
        'بناء وتطوير الساحات والميادين العامة',
        'صيانة الجسور والكباري وضمان سلامتها',
        'إنشاء محطات صرف صحي حديثة وصديقة للبيئة',
        'متابعة ميدانية دورية وخط ساخن للإبلاغ عن الأعطال'
      ]
    },
    {
      _id: 'employment-1',
      category: 'تشغيل',
      title: 'فرص عمل كريمة وتمكين اقتصادي',
      description: 'كل شاب وشابة يستحق فرصة عمل كريمة. سندعم المشروعات الصغيرة، ونوفر التدريب المهني، ونربط الشباب بفرص العمل المتاحة.',
      points: [
        'إنشاء مركز تدريب مهني مجاني يقدم دورات في المهن المطلوبة بسوق العمل',
        'دعم المشروعات الصغيرة والمتوسطة بقروض ميسرة بدون فوائد',
        'تنظيم معارض توظيف دورية تربط الشباب بأصحاب العمل',
        'برامج ريادة الأعمال وحاضنات أعمال لدعم الأفكار الإبداعية',
        'تمكين المرأة اقتصادياً من خلال مشروعات إنتاجية منزلية',
        'التنسيق مع القطاع الخاص لتوفير فرص عمل محلية',
        'دعم الحرفيين والمهنيين بورش مجهزة وتسويق منتجاتهم',
        'إنشاء سوق محلي دائم لعرض المنتجات المحلية'
      ]
    },
    {
      _id: 'youth-1',
      category: 'شباب ورياضة',
      title: 'شباب قوي ومجتمع رياضي نشط',
      description: 'الشباب هم طاقة المستقبل. سنستثمر في المراكز الشبابية والملاعب، ونوفر أنشطة رياضية وثقافية متنوعة لكل الأعمار.',
      points: [
        'تطوير مراكز الشباب وتجهيزها بقاعات أنشطة ومسارح',
        'إنشاء وصيانة ملاعب رياضية (كرة قدم، كرة سلة، كرة طائرة)',
        'دعم الفرق الرياضية المحلية وتوفير المعدات والزي الرياضي',
        'تنظيم بطولات ومهرجانات رياضية دورية بين القرى',
        'أنشطة صيفية متنوعة للأطفال والشباب (رحلات، ورش، مخيمات)',
        'دورات تنمية مهارات ومحو أمية رقمية للشباب',
        'مسابقات ثقافية وفنية سنوية لاكتشاف المواهب',
        'ربط الشباب ببرامج التطوع المجتمعي ومبادرات الخير'
      ]
    },
    {
      _id: 'econ-1',
      category: 'تنمية اقتصادية',
      title: 'تنمية اقتصادية مستدامة',
      description: 'نسعى لتحقيق تنمية اقتصادية حقيقية من خلال دعم الزراعة، وتشجيع الصناعات الصغيرة، وتحسين الخدمات التجارية.',
      points: [
        'دعم المزارعين بتوفير التقاوي والأسمدة المدعومة',
        'تحديث أساليب الري وتوفير مياه الري بانتظام',
        'إنشاء وحدات تصنيع زراعي (تجفيف، تعليب، تغليف) لزيادة القيمة المضافة',
        'تسهيل تسويق المحاصيل الزراعية بأسعار عادلة',
        'تشجيع الصناعات الحرفية والتراثية ودعم تسويقها',
        'إنشاء مناطق لوجستية وأسواق مركزية للتجار والمنتجين',
        'جذب استثمارات وطنية لإقامة مشروعات صناعية صغيرة',
        'ميكنة الخدمات الحكومية لتسهيل إجراءات التراخيص'
      ]
    },
    {
      _id: 'env-1',
      category: 'بيئة',
      title: 'بيئة نظيفة وآمنة للأجيال القادمة',
      description: 'الحفاظ على البيئة مسؤولية الجميع. سننشر الوعي البيئي، ونطور إدارة النفايات، ونزيد المساحات الخضراء.',
      points: [
        'حملات نظافة دورية وتوعية بأهمية الحفاظ على البيئة',
        'إنشاء نظام فعال لجمع ونقل القمامة من كل القرى',
        'دعم مشروعات تدوير النفايات وإنتاج السماد العضوي',
        'زراعة الأشجار والمساحات الخضراء في الشوارع والميادين',
        'إنشاء حدائق عامة آمنة للعائلات والأطفال',
        'مكافحة التلوث الصناعي والزراعي والحد من استخدام المبيدات الضارة',
        'تشجيع استخدام الطاقة المتجددة (الطاقة الشمسية) في المرافق العامة',
        'برامج توعية مدرسية للأطفال عن حماية البيئة'
      ]
    },
    {
      _id: 'culture-1',
      category: 'ثقافة',
      title: 'تراث أصيل وثقافة معاصرة',
      description: 'نحافظ على تراثنا ونشجع الإبداع الثقافي والفني، لنبني مجتمعاً واعياً ومثقفاً يفتخر بهويته.',
      points: [
        'إنشاء مكتبات عامة مجهزة في كل مركز وقرية رئيسية',
        'تنظيم ندوات ومحاضرات ثقافية وتوعوية شهرية',
        'دعم الفنانين والأدباء المحليين وإقامة معارض ومهرجانات',
        'توثيق التراث الشعبي والحرف اليدوية التقليدية',
        'إحياء المناسبات الثقافية والاحتفالات المحلية',
        'دورات فنية مجانية (رسم، موسيقى، مسرح) للأطفال والشباب',
        'إنشاء قاعات عرض ومسارح صغيرة للأنشطة الثقافية',
        'تشجيع القراءة بمسابقات وجوائز تحفيزية'
      ]
    },
    {
      _id: 'services-1',
      category: 'خدمات',
      title: 'خدمات حكومية سريعة وشفافة',
      description: 'نسهّل إجراءات الحصول على الخدمات الحكومية، ونعمل على حل المشاكل الإدارية بسرعة وشفافية.',
      points: [
        'تطوير مكاتب الخدمات الحكومية وتقليل مدة إنجاز المعاملات',
        'رقمنة الخدمات وإتاحة استعلامات إلكترونية',
        'تدريب الموظفين على حسن التعامل مع المواطنين',
        'إنشاء مكتب متابعة شكاوى المواطنين والرد السريع عليها',
        'تسهيل إجراءات استخراج الوثائق (بطاقات، شهادات ميلاد، رخص)',
        'ربط المكاتب الحكومية بشبكة موحدة لتسريع الإجراءات',
        'إقامة أيام خدمية مفتوحة لتقديم الخدمات بدون تعقيدات',
        'شفافية كاملة ونشر تقارير دورية عن الخدمات المقدمة'
      ]
    },
    {
      _id: 'housing-1',
      category: 'إسكان',
      title: 'إسكان آمن وكريم للجميع',
      description: 'كل أسرة تستحق بيتاً آمناً. سنعمل على توفير حلول إسكانية بأسعار معقولة، ودعم الأسر الأولى بالرعاية.',
      points: [
        'التنسيق مع الجهات المعنية لتوفير وحدات سكنية بأسعار مناسبة',
        'دعم الأسر الأولى بالرعاية بمساعدات مالية لتحسين مساكنهم',
        'صيانة المساكن المتهالكة وتوفير مواد بناء مدعومة',
        'توفير أراضي سكنية بتسهيلات للشباب المقبلين على الزواج',
        'تطوير البنية التحتية في المناطق العشوائية',
        'دعم برامج الإسكان الاجتماعي والتمويل العقاري الميسر',
        'إنشاء مجمعات سكنية متكاملة بالخدمات الأساسية',
        'تسهيل إجراءات التراخيص والتصاريح للبناء'
      ]
    }
  ];

  const categoryIcons = {
    'تعليم': <FaGraduationCap />,
    'صحة': <FaHospital />,
    'تشغيل': <FaBriefcase />,
    'بنية تحتية': <FaRoad />,
    'شباب ورياضة': <FaFutbol />,
    'تنمية اقتصادية': <FaChartLine />,
    'بيئة': <FaLeaf />,
    'ثقافة': <FaBook />,
    'خدمات': <FaHandsHelping />,
    'إسكان': <FaHome />,
  };

  useEffect(() => {
    fetchProgram();
  }, []);

  const fetchProgram = async () => {
    try {
      const response = await programAPI.getAll();
      const fetchedData = response.data.data || [];
      // استخدام البيانات المجلوبة، وإن لم تكن موجودة نستخدم fallback
      setProgram(fetchedData.length > 0 ? fetchedData : fallbackProgram);
    } catch (error) {
      console.error('Error fetching program:', error);
      // في حالة فشل API، نستخدم البرنامج الكامل
      setProgram(fallbackProgram);
    } finally {
      setLoading(false);
    }
  };

  const categories = ['الكل', ...new Set(program.map(item => item.category))];

  const filteredProgram = selectedCategory === 'الكل' 
    ? program 
    : program.filter(item => item.category === selectedCategory);

  return (
    <>
      <Head>
        <title>البرنامج الانتخابي - محمد إبراهيم علي الناغي</title>
        <meta name="description" content="البرنامج الانتخابي الشامل للمرشح محمد إبراهيم علي الناغي" />
      </Head>

      {/* Hero */}
      <section className="bg-gradient-to-r from-primary-700 to-primary-900 text-white py-16">
        <div className="container-custom">
          <h1 className="text-4xl md:text-5xl font-bold mb-4">البرنامج الانتخابي</h1>
          <p className="text-xl text-primary-100">خريطة طريق واقعية بأهداف زمنية ومؤشرات قياس للأثر في دائرة منية النصر والكردي وميت سلسيل والجمالية</p>
        </div>
      </section>

      {/* Category Filter */}
      <section className="bg-white py-8 sticky top-[72px] z-40 shadow-md">
        <div className="container-custom">
          <div className="flex flex-wrap gap-3 justify-center">
            {categories.map((category) => (
              <button
                key={category}
                onClick={() => setSelectedCategory(category)}
                className={`px-6 py-2 rounded-full font-semibold transition-all ${
                  selectedCategory === category
                    ? 'bg-primary-600 text-white shadow-lg'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                {category}
              </button>
            ))}
          </div>
        </div>
      </section>

      {/* Program Items */}
      <section className="py-16 bg-gray-50">
        <div className="container-custom">
          {loading ? (
            <div className="flex justify-center items-center py-20">
              <div className="spinner"></div>
            </div>
          ) : (
            <div className="space-y-8">
              <div className="card p-6">
                <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-3">رؤية وأولويات</h2>
                <p className="text-gray-700 leading-relaxed">
                  نلتزم ببرنامج يُعلي من كرامة المواطن ويضع الخدمات الأساسية في المقدمة: مدارس آمنة ومعلمين مدرَّبين،
                  وحدات صحية تعمل بكفاءة، طرق ومرافق متاحة للجميع، وتمكين اقتصادي للشباب والمرأة. نعتمد على شراكات مع
                  الجهات التنفيذية والمجتمع المدني، وجدول زمني واضح، ومتابعة شهرية معلنة لضمان الشفافية والمحاسبة.
                </p>
              </div>
              {filteredProgram.map((item) => (
                <div key={item._id} className="card p-8 hover:shadow-2xl transition-shadow">
                  <div className="flex items-start gap-6">
                    <div className="text-6xl text-primary-600 flex-shrink-0">
                      {categoryIcons[item.category] || <FaChartLine />}
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-4">
                        <span className="bg-primary-100 text-primary-700 px-4 py-1 rounded-full text-sm font-semibold">
                          {item.category}
                        </span>
                      </div>
                      <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-4">
                        {item.title}
                      </h2>
                      <p className="text-gray-700 text-lg leading-relaxed mb-6">
                        {item.description}
                      </p>
                      {item.points && item.points.length > 0 && (
                        <div>
                          <h3 className="text-xl font-bold text-gray-900 mb-3">النقاط الرئيسية:</h3>
                          <ul className="space-y-2">
                            {item.points.map((point, index) => (
                              <li key={index} className="flex items-start gap-3">
                                <span className="text-primary-600 text-xl mt-1">◄</span>
                                <span className="text-gray-700">{point}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              ))}

              {filteredProgram.length === 0 && (
                <div className="text-center py-12">
                  <p className="text-gray-500 text-lg">لا توجد عناصر في هذا التصنيف</p>
                </div>
              )}
            </div>
          )}
        </div>
      </section>
    </>
  );
};

export default ProgramPage;
